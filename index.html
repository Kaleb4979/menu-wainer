<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pa que Wainer - Men√∫ y Pedidos</title>
    
    <style>
        :root {
            --color-wainer-red: #C00000;
            --color-wainer-gold: #FFD700;
            --color-wainer-dark: #333;
            --color-wainer-light: #FFF;
            --color-whatsapp-green: #25D366;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-wainer-dark);
            color: var(--color-wainer-light);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        .hero {
            background-color: var(--color-wainer-red);
            color: var(--color-wainer-gold);
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }

        .logo {
            max-width: 180px;
            height: auto;
            display: block;
            margin: 0 auto 10px;
            border-radius: 5px;
        }

        .hero h1 {
            font-size: 1.5em;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .menu-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .menu-category {
            background-color: #222;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 10px;
            border-left: 5px solid var(--color-wainer-gold);
        }

        .menu-category h2 {
            color: var(--color-wainer-gold);
            border-bottom: 2px solid var(--color-wainer-red);
            padding-bottom: 5px;
            margin-top: 0;
            font-size: 1.8em;
        }

        .slogan {
            font-style: italic;
            color: #AAA;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dotted #555;
            font-size: 1.1em;
        }

        /* Estilos del Carrito */
        .item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .price {
            font-weight: bold;
            color: var(--color-wainer-gold);
            min-width: 40px;
            text-align: right;
        }
        .quantity-control {
            display: flex;
            align-items: center;
            background-color: #444;
            border-radius: 5px;
            overflow: hidden;
        }
        .quantity-btn {
            background-color: var(--color-wainer-red);
            color: var(--color-wainer-light);
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .item-quantity {
            padding: 5px 10px;
            color: var(--color-wainer-light);
            font-weight: bold;
            min-width: 15px;
            text-align: center;
        }
        
        /* CARRITO FLOTANTE */
        .cart-float {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--color-whatsapp-green);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-float button {
            background-color: var(--color-wainer-dark); /* Color de fondo cuando est√° activo */
            color: var(--color-wainer-gold);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: background-color 0.2s;
        }
        
        /* ESTILO PARA EL BOT√ìN DESHABILITADO (Gris) - SOLUCI√ìN AL PROBLEMA DE COLOR */
        .cart-float button:disabled {
            background-color: #666 !important;
            color: #BBB !important;
            cursor: not-allowed;
        }

        .cart-total {
            font-size: 1.4em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            text-align: left;
        }
        
        /* Secci√≥n de Opciones de Pedido (Delivery) */
        .order-options {
            background-color: #444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .delivery-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }

        .order-options label {
            display: flex;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
        }

        .order-options input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-left: 10px;
            cursor: pointer;
            accent-color: var(--color-wainer-gold);
        }

        .delivery-info {
            font-size: 0.9em;
            color: #ccc;
            margin-left: 30px;
        }
        
        .loading-message {
            color: var(--color-wainer-gold);
            font-weight: bold;
            margin-top: 10px;
            text-align: center;
        }
        
        footer { display: none; }
    </style>
</head>
<body>
    <header class="hero">
        <img src="https://i.imgur.com/PGbrz8M.jpg" alt="Logo Pa que Wainer" class="logo">
        <h1>LA MEJOR CALIDAD EN COMIDA R√ÅPIDA</h1>
    </header>

    <main class="menu-container">
        
        <div class="order-options">
            <div class="delivery-toggle">
                <label for="delivery-checkbox">
                    üöö ¬øDesea Delivery?
                </label>
                <input type="checkbox" id="delivery-checkbox" onchange="updateCartDisplay()">
            </div>
            <div id="delivery-details" class="delivery-info">
                Seleccione Delivery para calcular el costo. (1$ por km, m√≠nimo 1$)
            </div>
        </div>
        
        <div id="loading-location" class="loading-message" style="display:none;">
            Obteniendo tu ubicaci√≥n para calcular el costo... Por favor, acepta el permiso.
        </div>
        
        <section class="menu-category">
            <h2>ü•ñ Panes: ¬°El Cl√°sico R√°pido!</h2>
            <p class="slogan">Ideales para una merienda r√°pida o un desayuno express.</p>
            <div class="menu-item-list">
                <div class="menu-item" data-id="pan-salchicha" data-name="Pan Salchicha" data-price="1.00" data-category="Panes">
                    <span class="item-info">Salchicha</span>
                    <div class="item-controls">
                        <span class="price">1.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pan-salchicha', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pan-salchicha', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="pan-huevo" data-name="Pan Huevo" data-price="1.00" data-category="Panes">
                    <span class="item-info">Huevo</span>
                    <div class="item-controls">
                        <span class="price">1.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pan-huevo', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pan-huevo', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="pan-cebu" data-name="Pan Ceb√∫" data-price="1.00" data-category="Panes">
                    <span class="item-info">Ceb√∫</span>
                    <div class="item-controls">
                        <span class="price">1.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pan-cebu', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pan-cebu', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="pan-salchiqueso" data-name="Pan Salchiqueso" data-price="1.50" data-category="Panes">
                    <span class="item-info">Salchiqueso</span>
                    <div class="item-controls">
                        <span class="price">1.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pan-salchiqueso', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pan-salchiqueso', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="menu-category">
            <h2>üåæ Pan Granjero: El Gigante de la Ciudad</h2>
            <p class="slogan">Un pan grande y completo con tu prote√≠na favorita, siempre acompa√±ado del mejor Ceb√∫.</p>
            <div class="menu-item-list">
                <div class="menu-item" data-id="gran-carne" data-name="Granjero Carne y Ceb√∫" data-price="3.50" data-category="Granjero">
                    <span class="item-info">Carne y Ceb√∫</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('gran-carne', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('gran-carne', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="gran-pollo" data-name="Granjero Pollo y Ceb√∫" data-price="3.50" data-category="Granjero">
                    <span class="item-info">Pollo y Ceb√∫</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('gran-pollo', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('gran-pollo', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="gran-lomonegro" data-name="Granjero Lomo Negro y Ceb√∫" data-price="3.50" data-category="Granjero">
                    <span class="item-info">Lomo Negro y Ceb√∫</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('gran-lomonegro', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('gran-lomonegro', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="gran-lomito" data-name="Granjero Lomito y Ceb√∫" data-price="3.50" data-category="Granjero">
                    <span class="item-info">Lomito y Ceb√∫</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('gran-lomito', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('gran-lomito', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="gran-pernil" data-name="Granjero Pernil y Ceb√∫" data-price="3.50" data-category="Granjero">
                    <span class="item-info">Pernil y Ceb√∫</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('gran-pernil', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('gran-pernil', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="gran-chuleta" data-name="Granjero Chuleta y Ceb√∫" data-price="3.50" data-category="Granjero">
                    <span class="item-info">Chuleta y Ceb√∫</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('gran-chuleta', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('gran-chuleta', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="menu-category">
            <h2>ü´ì Arepas o Tumbarranchos: ¬°Sabor Zuliano!</h2>
            <p class="slogan">La tradici√≥n que enamora. Rellenos que te har√°n sentir en casa.</p>
            <div class="menu-item-list">
                <div class="menu-item" data-id="arepa-tradicional" data-name="Arepa Tradicional (2x)" data-price="1.50" data-category="Arepas">
                    <span class="item-info">Tradicional (2x)</span>
                    <div class="item-controls">
                        <span class="price">1.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('arepa-tradicional', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('arepa-tradicional', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="arepa-carne" data-name="Arepa Carne" data-price="3.50" data-category="Arepas">
                    <span class="item-info">Carne</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('arepa-carne', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('arepa-carne', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="arepa-pollo" data-name="Arepa Pollo" data-price="3.50" data-category="Arepas">
                    <span class="item-info">Pollo</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('arepa-pollo', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('arepa-pollo', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="arepa-lomito" data-name="Arepa Lomito" data-price="3.50" data-category="Arepas">
                    <span class="item-info">Lomito</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('arepa-lomito', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('arepa-lomito', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="arepa-chuleta" data-name="Arepa Chuleta" data-price="3.50" data-category="Arepas">
                    <span class="item-info">Chuleta</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('arepa-chuleta', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('arepa-chuleta', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="menu-category">
            <h2>üçü Hamburguesas: ¬°Poder Wainer!</h2>
            <p class="slogan">Elige la experiencia Wainer que se adapte a tu hambre. Calidad inigualable.</p>
            <div class="menu-item-list">
                <div class="menu-item" data-id="hamb-mini" data-name="Mini de Carne" data-price="1.00" data-category="Hamburguesas">
                    <span class="item-info">Mini de Carne</span>
                    <div class="item-controls">
                        <span class="price">1.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('hamb-mini', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('hamb-mini', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="hamb-pollo" data-name="Hamburguesa Pollo" data-price="1.50" data-category="Hamburguesas">
                    <span class="item-info">Pollo</span>
                    <div class="item-controls">
                        <span class="price">1.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('hamb-pollo', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('hamb-pollo', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item highlight-row" data-id="hamb-whopper" data-name="Whopper" data-price="3.50" data-category="Hamburguesas">
                    <span class="item-info">**Whopper**</span>
                    <div class="item-controls">
                        <span class="price">**3.50$**</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('hamb-whopper', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('hamb-whopper', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item highlight-row" data-id="hamb-combo" data-name="Whopper y Papas (Combo)" data-price="5.00" data-category="Hamburguesas">
                    <span class="item-info">**Whopper y Papas (Combo)**</span>
                    <div class="item-controls">
                        <span class="price">**5.00$**</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('hamb-combo', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('hamb-combo', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="hamb-full" data-name="Whopper Extra Full" data-price="8.00" data-category="Hamburguesas">
                    <span class="item-info">Whopper Extra Full</span>
                    <div class="item-controls">
                        <span class="price">8.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('hamb-full', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('hamb-full', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="menu-category">
            <h2>üåø Patacones: Crujientes y Rellenos</h2>
            <p class="slogan">La base perfecta para los mejores rellenos. Nuestro favorito.</p>
            <div class="menu-item-list">
                <div class="menu-item" data-id="pata-normal" data-name="Patac√≥n Normal" data-price="3.50" data-category="Patacones">
                    <span class="item-info">Normal</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pata-normal', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pata-normal', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="pata-papa" data-name="Patac√≥n y Papa" data-price="5.00" data-category="Patacones">
                    <span class="item-info">Patac√≥n y Papa</span>
                    <div class="item-controls">
                        <span class="price">5.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pata-papa', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pata-papa', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="pata-especial" data-name="Patac√≥n Especial" data-price="6.00" data-category="Patacones">
                    <span class="item-info">Patac√≥n Especial</span>
                    <div class="item-controls">
                        <span class="price">6.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pata-especial', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pata-especial', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="pata-full" data-name="Patac√≥n Extra Full" data-price="9.00" data-category="Patacones">
                    <span class="item-info">Patac√≥n Extra Full</span>
                    <div class="item-controls">
                        <span class="price">9.00$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('pata-full', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('pata-full', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="menu-category">
            <h2>‚ûï Complementos</h2>
            <p class="slogan">A√±ade un extra de sabor a tu pedido.</p>
            <div class="menu-item-list">
                <div class="menu-item" data-id="comp-yoyos" data-name="Yoyos" data-price="3.50" data-category="Complementos">
                    <span class="item-info">Yoyos</span>
                    <div class="item-controls">
                        <span class="price">3.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('comp-yoyos', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('comp-yoyos', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-id="comp-papas" data-name="Servicio de Papas" data-price="2.50" data-category="Complementos">
                    <span class="item-info">Servicio de Papas</span>
                    <div class="item-controls">
                        <span class="price">2.50$</span>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateCart('comp-papas', -1)">-</button>
                            <span class="item-quantity">0</span>
                            <button class="quantity-btn" onclick="updateCart('comp-papas', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <div class="cart-float">
        <div class="cart-total">
            üõí Total: <span id="cart-total-price">0.00</span>$
        </div>
        <button onclick="checkAndSendOrder()" id="checkout-btn" disabled>
            Hacer Pedido por WhatsApp
        </button>
    </div>

    <footer style="display:none;">
        <p>¬© 2025 Pa que Wainer. Todos los derechos reservados.</p>
    </footer>


    <script>
        const WHATSAPP_NUMBER = '584120719505';
        let cart = {}; 
        
        // *** COORDENADAS DE TU NEGOCIO (CONFIGURADAS) ***
        const ORIGIN_LAT = 10.6608820; 
        const ORIGIN_LON = -71.5990720; 
        // ***********************************************


        // --- Funciones de Utilidad ---

        // Funci√≥n de Haversine para calcular la distancia entre dos coordenadas (en km)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radio de la Tierra en kil√≥metros
            const toRad = (value) => (value * Math.PI) / 180;

            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c; // Distancia en km
            
            return distance;
        }


        // --- Funciones de Carrito y Display ---
        function updateCart(itemId, change) {
            const itemElement = document.querySelector(`[data-id="${itemId}"]`);
            const itemPrice = parseFloat(itemElement.getAttribute('data-price'));
            
            let currentQuantity = cart[itemId] ? cart[itemId].quantity : 0;
            let newQuantity = currentQuantity + change;

            if (newQuantity < 0) return;

            if (newQuantity === 0) {
                delete cart[itemId];
            } else {
                cart[itemId] = {
                    id: itemId,
                    name: itemElement.getAttribute('data-name'),
                    price: itemPrice,
                    category: itemElement.getAttribute('data-category'),
                    quantity: newQuantity
                };
            }

            updateCartDisplay();
        }

        function updateCartDisplay() {
            let subtotal = 0;
            let totalItems = 0;
            
            for (const id in cart) {
                const item = cart[id];
                subtotal += item.price * item.quantity;
                totalItems += item.quantity;
            }

            const isDelivery = document.getElementById('delivery-checkbox').checked;
            const deliveryDetails = document.getElementById('delivery-details');
            const checkoutBtn = document.getElementById('checkout-btn');

            document.querySelectorAll('.menu-item').forEach(itemEl => {
                const itemId = itemEl.getAttribute('data-id');
                const quantityElement = itemEl.querySelector('.item-quantity');
                quantityElement.textContent = cart[itemId] ? cart[itemId].quantity : 0;
            });

            if (totalItems > 0) {
                checkoutBtn.disabled = false;
            } else {
                checkoutBtn.disabled = true;
                checkoutBtn.textContent = `Hacer Pedido por WhatsApp`;
            }
            
            // L√≥gica del Delivery y display de totales
            if (isDelivery) {
                document.getElementById('cart-total-price').textContent = subtotal.toFixed(2);
                deliveryDetails.textContent = "Costo de Delivery se calcular√° al confirmar la ubicaci√≥n. (1$ por km, m√≠nimo 1$)";
                checkoutBtn.textContent = `Hacer Pedido (${totalItems} √≠tems) - Subtotal: ${subtotal.toFixed(2)}$`;
                
                if (totalItems === 0) {
                     deliveryDetails.textContent = "Seleccione Delivery para calcular el costo. (1$ por km, m√≠nimo 1$)";
                }
            } else {
                document.getElementById('cart-total-price').textContent = subtotal.toFixed(2);
                deliveryDetails.textContent = "Retiro en Tienda seleccionado.";
                checkoutBtn.textContent = `Hacer Pedido (${totalItems} √≠tems) - Total: ${subtotal.toFixed(2)}$`;
            }

            if (totalItems === 0) {
                document.getElementById('cart-total-price').textContent = "0.00";
            }
        }
        
        // --- L√≥gica de Env√≠o ---

        function sendOrder(subtotal, finalTotal, distanceKm, lat, lon) {
            
            const isDelivery = document.getElementById('delivery-checkbox').checked;
            let message = "üõí *NUEVO PEDIDO PA QUE WAINER* üçî\n\n";
            
            for (const id in cart) {
                const item = cart[id];
                const itemSubtotal = item.price * item.quantity;
                message += `*${item.quantity}x* ${item.name} = ${itemSubtotal.toFixed(2)}$\n`;
            }

            message += "\n----------------------------------\n";
            
            if (isDelivery) {
                const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
                
                if (distanceKm > 0) {
                    const deliveryCost = finalTotal - subtotal;
                    
                    message += `‚úÖ *SERVICIO:* DELIVERY üöö\n`;
                    message += `üìç *DISTANCIA CALCULADA:* ${distanceKm.toFixed(2)} km\n`;
                    message += `üíµ *COSTO DELIVERY:* ${deliveryCost.toFixed(2)}$ (${distanceKm.toFixed(2)} km * 1$/km)\n`;
                    message += `\n*SUBTOTAL (Comida):* ${subtotal.toFixed(2)}$\n`;
                    message += `*TOTAL FINAL:* ${finalTotal.toFixed(2)}$\n`;
                    message += `üó∫Ô∏è *UBICACI√ìN CLIENTE:* ${mapsUrl}\n`;
                    
                } else {
                    message += `‚ùå *SERVICIO:* DELIVERY (FALLIDO) üöö\n`;
                    message += `‚ö†Ô∏è *ATENCI√ìN:* No se pudo obtener la ubicaci√≥n o fue rechazada. El costo de delivery se calcular√° a la entrega.\n`;
                    message += `\n*TOTAL A PAGAR (Comida):* ${subtotal.toFixed(2)}$\n`;
                }
            } else {
                message += `‚úÖ *SERVICIO:* RETIRO EN TIENDA üö∂\n`;
                message += `üí∞ *TOTAL A PAGAR:* ${subtotal.toFixed(2)}$\n`;
            }
            
            message += "----------------------------------\n";
            message += "\nPor favor, indique su nombre y direcci√≥n exacta.";

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;

            window.open(whatsappUrl, '_blank');
            
            // VACIAR Y REFRESCAR CARRITO
            cart = {};
            updateCartDisplay();
        }

        function checkAndSendOrder() {
            const isDelivery = document.getElementById('delivery-checkbox').checked;
            const checkoutBtn = document.getElementById('checkout-btn');
            
            let subtotal = 0;
            for (const id in cart) {
                subtotal += cart[id].price * cart[id].quantity;
            }

            if (!isDelivery) {
                sendOrder(subtotal, subtotal, 0, 0, 0); 
                return;
            }
            
            // Si es Delivery, intentamos obtener la ubicaci√≥n y calcular
            checkoutBtn.disabled = true;
            checkoutBtn.textContent = 'Calculando env√≠o...';
            document.getElementById('loading-location').style.display = 'block';


            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // √âxito: Ubicaci√≥n obtenida
                        const clientLat = position.coords.latitude;
                        const clientLon = position.coords.longitude;
                        
                        const distanceKm = calculateDistance(ORIGIN_LAT, ORIGIN_LON, clientLat, clientLon);
                        
                        // Costo: 1$ por km, m√≠nimo 1$
                        const deliveryCost = Math.max(1.00, distanceKm * 1.00); 
                        
                        const finalTotal = subtotal + deliveryCost;

                        checkoutBtn.textContent = 'Hacer Pedido';
                        document.getElementById('loading-location').style.display = 'none';

                        sendOrder(subtotal, finalTotal, distanceKm, clientLat, clientLon);
                    },
                    (error) => {
                        // Error: Usuario no dio permiso o hay error
                        console.error('Error de geolocalizaci√≥n:', error);
                        
                        checkoutBtn.textContent = 'Hacer Pedido (Env√≠o Pendiente)';
                        document.getElementById('loading-location').style.display = 'none';

                        sendOrder(subtotal, subtotal, 0, 0, 0); // Env√≠o pendiente
                    }
                );
            } else {
                // Navegador no soporta Geolocalizaci√≥n
                console.error('Geolocalizaci√≥n no soportada.');
                
                checkoutBtn.textContent = 'Hacer Pedido (Env√≠o Pendiente)';
                document.getElementById('loading-location').style.display = 'none';
                
                sendOrder(subtotal, subtotal, 0, 0, 0); // Env√≠o pendiente
            }
        }

        document.addEventListener('DOMContentLoaded', updateCartDisplay);
    </script>
</body>
</html>
